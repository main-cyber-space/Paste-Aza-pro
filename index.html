<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Paste Aza Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root { --bg-light:#f5f5f5; --bg-dark:#121212; --text-light:#333; --text-dark:#fff; --card-light:#fff; --card-dark:#1e1e1e; --primary:#6a1b9a; }
    body{margin:0;font-family:Arial, sans-serif;background:var(--bg-light);color:var(--text-light);transition:0.3s;}
    h1{margin:0;padding:20px 0;text-align:center;color:#fff;background:var(--primary);font-size:26px;}
    h2{text-align:center;margin-bottom:20px;color:var(--primary);}
    .button-row{display:flex;justify-content:center;gap:15px;background:#eee;padding:15px;}
    .button-row .small-btn{background:var(--primary);border:none;color:#fff;padding:10px 15px;border-radius:8px;cursor:pointer;font-size:14px;display:flex;align-items:center;gap:6px;transition:0.2s;}
    .button-row .small-btn i{font-size:16px;}
    .button-row .small-btn:hover{opacity:0.85;}
    .banks{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;margin-top:30px;}
    .bank-card{background:var(--card-light);padding:25px 15px;text-align:center;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);cursor:pointer;transition:0.2s;}
    body.dark .bank-card{background:var(--card-dark);box-shadow:0 4px 6px rgba(255,255,255,0.05);}
    .bank-card:hover{transform:translateY(-4px);}
    .bank-card i{font-size:28px;color:var(--primary);margin-bottom:8px;}
    .bank-card h3{margin:0;font-size:15px;}
    .channel-link{margin:40px 0;text-align:center;}
    .channel-link a{color:var(--primary);font-weight:bold;text-decoration:none;font-size:16px;display:inline-flex;align-items:center;gap:8px;}
    .channel-link a:hover{text-decoration:underline;}
    .subscription-banner {
      background: #4caf50;
      color: white;
      text-align: center;
      padding: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- Main Header -->
  <h1>Paste Aza Pro</h1>

  <!-- Subscription Banner -->
  <div class="subscription-banner" id="subscriptionBanner">
    Checking subscription status...
  </div>

  <!-- Button Row -->
  <div class="button-row">
    <button id="buyTokenBtn" class="small-btn"><i class="fa-solid fa-cart-shopping"></i> Buy Token</button>
    <button id="developerBtn" class="small-btn"><i class="fa-solid fa-comment-dots"></i> Developer</button>
    <button id="profileBtn" class="small-btn"><i class="fa-solid fa-user"></i> Profile</button>
  </div>

  <!-- Content -->
  <div class="container">
    <h2>Choose a Bank to Generate Receipt</h2>
    <div class="banks">
      <div class="bank-card" data-page="palmpayform.html"><i class="fa-solid fa-building-columns"></i><h3>PalmPay</h3></div>
      <div class="bank-card" data-page="opayform.html"><i class="fa-solid fa-building-columns"></i><h3>Opay</h3></div>
      <div class="bank-card" data-page="receiptform.html"><i class="fa-solid fa-building-columns"></i><h3>Kuda</h3></div>
    </div>

    <!-- Telegram channel link -->
    <div class="channel-link">
      <a href="https://t.me/web404space" target="_blank">
        <i class="fa-brands fa-telegram"></i> Join Our Channel
      </a>
    </div>
  </div>

<script>
/* --- Authentication check --- */
fetch('/api/check-auth')
  .then(response => response.json())
  .then(data => {
    if (!data.isLoggedIn) {
      window.location.href = 'login.html';
    }
  })
  .catch(error => console.error('Auth check error:', error));

/* --- Check token status --- */
fetch('/api/user/token')
  .then(response => response.json())
  .then(data => {
    const banner = document.getElementById('subscriptionBanner');
    
    if (data.success && data.hasToken) {
      // User has a valid token
      const planName = data.plan === 'week' ? '1 Week' : 
                       data.plan === 'month' ? '1 Month' : 
                       data.plan === 'lifetime' ? 'Lifetime' : data.plan;
      
      if (data.expiresAt) {
        const expiryDate = new Date(data.expiresAt);
        const now = new Date();
        const daysLeft = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
        
        banner.style.background = '#4caf50';
        banner.innerHTML = `Active Subscription: ${planName} Plan - ${daysLeft} days remaining`;
      } else {
        banner.style.background = '#4caf50';
        banner.innerHTML = `Active Subscription: ${planName} Plan - Never Expires`;
      }
    } else {
      // No valid token
      banner.style.background = '#f44336';
      banner.innerHTML = 'Your account is not activated. Please purchase a token to access all features.';
      
      // Disable bank cards
      document.querySelectorAll('.bank-card').forEach(card => {
        card.style.opacity = '0.5';
        card.style.cursor = 'not-allowed';
        card.removeAttribute('data-page');
        
        card.addEventListener('click', e => {
          e.preventDefault();
          Swal.fire({
            title: 'Activation Required',
            text: 'You need to activate your account with a token to access this feature',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Activate Now',
            cancelButtonText: 'Later',
            confirmButtonColor: '#6a1b9a'
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = 'activate.html';
            }
          });
        });
      });
    }
  })
  .catch(error => {
    console.error('Error checking token status:', error);
    document.getElementById('subscriptionBanner').innerHTML = 'Could not verify subscription status';
  });

/* --- disable inspect --- */
document.onkeydown = function(e){
  if(e.keyCode==123 || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase())) || (e.ctrlKey && e.key.toUpperCase()=='U')) {
    return false;
  }
};
document.addEventListener('contextmenu', e => e.preventDefault());

/* --- Buy token --- */
document.getElementById('buyTokenBtn').onclick = function(){
  Swal.fire('Buy Token','Redirecting to WhatsApp seller...','info');
  window.open("https://wa.me/2349020388011?text=Hello, I want to buy a token for Paste Aza Pro","_blank");
};

/* --- Developer --- */
document.getElementById('developerBtn').onclick = function(){
  window.location.href = "developer.html";
};

/* --- Profile --- */
document.getElementById('profileBtn').onclick = function(){
  window.location.href = "profile.html";
};

/* --- Bank card click --- */
document.querySelectorAll('.bank-card[data-page]').forEach(card=>{
  card.addEventListener('click', e=>{
    const page = card.dataset.page;
    if (page) {
      window.location.href = page;
    }
  });
});

/* --- Additional anti-inspect protection --- */
(function() {
  function blockDevTools() {
    if(window.devtools.isOpen) {
      window.location.href = 'blocked.html';
    }
  }
  
  // Create devtools detector
  const devtools = {
    isOpen: false,
    orientation: undefined
  };
  
  // Add detector
  const threshold = 160;
  const emitEvent = (isOpen, orientation) => {
    window.devtools = { isOpen, orientation };
  };
  
  // Check width/height differential
  setInterval(() => {
    const widthThreshold = window.outerWidth - window.innerWidth > threshold;
    const heightThreshold = window.outerHeight - window.innerHeight > threshold;
    const orientation = widthThreshold ? 'vertical' : 'horizontal';
    
    if(widthThreshold || heightThreshold) {
      if(!devtools.isOpen || devtools.orientation !== orientation) {
        emitEvent(true, orientation);
        blockDevTools();
      }
    } else {
      if(devtools.isOpen) {
        emitEvent(false, null);
      }
    }
  }, 500);
})();
</script>
</body>
</html>
