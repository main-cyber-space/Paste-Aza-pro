<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Paste Aza Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root { --bg-light:#f5f5f5; --bg-dark:#121212; --text-light:#333; --text-dark:#fff; --card-light:#fff; --card-dark:#1e1e1e; --primary:#1a73e8; }
    body{margin:0;font-family:Arial, sans-serif;background:var(--bg-light);color:var(--text-light);transition:0.3s;}
    body.dark{background:var(--bg-dark);color:var(--text-dark);}
    .container{padding:20px;}
    h2{text-align:center;margin-bottom:20px;color:var(--primary);}
    .banks{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;}
    .bank-card{background:var(--card-light);padding:25px 15px;text-align:center;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);cursor:pointer;transition:0.2s;}
    body.dark .bank-card{background:var(--card-dark);box-shadow:0 4px 6px rgba(255,255,255,0.05);}
    .bank-card:hover{transform:translateY(-4px);}
    .bank-card i{font-size:28px;color:var(--primary);margin-bottom:8px;}
    .bank-card h3{margin:0;font-size:15px;}
    .actions{text-align:center;margin-top:30px;}
    .actions button,.actions a{margin:10px;padding:10px 15px;border:none;border-radius:8px;cursor:pointer;font-size:14px;background:var(--primary);color:#fff;text-decoration:none;display:inline-block;}
    .header-row{display:flex;align-items:center;justify-content:space-between;background:var(--primary);color:#fff;padding:15px;font-size:20px;font-weight:bold;}
    .header-row .title{flex:1;text-align:center;}
    .header-row .right-controls{display:flex;gap:8px;align-items:center;}
    .small-btn{background:transparent;border:none;color:#fff;padding:8px;border-radius:20px;cursor:pointer;font-size:16px;}
    #lottieBlock{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;color:#fff;font-size:22px;font-weight:bold;}
    #lottie{width:250px;height:250px;margin-bottom:20px;}
    .pricing{margin-top:40px;text-align:center;font-size:16px;font-weight:bold;animation: blink 2s infinite;}
    @keyframes blink{0%{color:#1a73e8;}50%{color:#e91e63;}100%{color:#1a73e8;}}
  </style>
</head>
<body>

  <div id="lottieBlock" style="display:none;">
    <div id="lottie"></div>
    <div>419 Cheating üòÇ</div>
  </div>

  <div class="header-row">
    <div class="title">Paste Aza Pro</div>
    <div class="right-controls">
      <button id="statusBtn" class="small-btn" title="View Status"><i class="fa-solid fa-id-badge"></i></button>
      <button class="small-btn" id="themeToggle" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </div>
  </div>

  <div class="container">
    <h2>Choose a Bank to Generate Receipt</h2>
    <div class="banks">
      <div class="bank-card" data-page="palmpayform.html"><i class="fa-solid fa-building-columns"></i><h3>PalmPay</h3></div>
      <div class="bank-card" data-page="opayform.html"><i class="fa-solid fa-building-columns"></i><h3>Opay</h3></div>
      <div class="bank-card" data-page="receiptform.html"><i class="fa-solid fa-building-columns"></i><h3>Kuda</h3></div>
      <div class="bank-card" id="telegramCard"><i class="fa-brands fa-telegram bounce"></i><h3>Channel</h3></div>
    </div>

    <div class="pricing">üöÄ Token Plans: <br>One Week ‚Üí ‚Ç¶3,000 <br>One Month ‚Üí ‚Ç¶6,500 <br>Unlimited ‚Üí ‚Ç¶12,000</div>

    <div class="actions">
      <button onclick="copyUID()">üìã Copy UID</button>
      <a href="developer.html">üí¨ Contact Developer</a>
      <a id="statusLink" href="status.html" style="background:green;">üîç View Status</a>
      <a id="buyTokenBtn" style="background:orange;cursor:pointer;">üí≥ Buy Token</a>
    </div>
  </div>

<script>
/* --- Supabase init --- */
const SUPABASE_URL = "https://zwmditpxtvqwugsdmulr.supabase.co";
const SUPABASE_ANON_KEY = "PASTE-YOUR-ANON-PUBLIC-KEY-HERE"; 
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* --- anti-inspect --- */
document.onkeydown = function(e){
  if(e.keyCode==123 || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase())) || (e.ctrlKey && e.key.toUpperCase()=='U')) {
    return false;
  }
};
document.addEventListener('contextmenu', e => e.preventDefault());

/* --- platform detect --- */
function detectPlatform(){ const ua=navigator.userAgent.toLowerCase(); if(/android/i.test(ua)) return "android"; if(/iphone|ipad|ipod/i.test(ua)) return "ios"; if(/win/i.test(ua)) return "windows"; return "other"; }
function blockWindows(){ document.getElementById("lottieBlock").style.display="flex"; lottie.loadAnimation({container:document.getElementById("lottie"),renderer:"svg",loop:true,autoplay:true,path:"https://assets1.lottiefiles.com/packages/lf20_j1adxtyb.json"}); document.body.style.overflow="hidden"; }
const platform = detectPlatform(); if (platform==="windows" || platform==="other") blockWindows();

/* --- Telegram popup every 30 mins --- */
function showTelegramPopup(){ Swal.fire({icon:'warning',title:'Join Our Telegram Channel',html:'<p>Stay updated and purchase your token easily.</p><a href="https://t.me/web404space" target="_blank" style="color:#1a73e8;font-weight:bold;">üëâ Click Here to Join</a>',confirmButtonText:'OK'}); }
window.onload = function(){
  const lastShown = localStorage.getItem('lastTelegramPopup');
  const now = Date.now();
  if (!lastShown || now - lastShown > 30*60*1000) { showTelegramPopup(); localStorage.setItem('lastTelegramPopup', now); }
};

/* --- Buy token via WhatsApp --- */
document.getElementById('buyTokenBtn').onclick = function(){
  const phone = "2349020388011";
  const message = encodeURIComponent("Hello, I want to buy a token for Paste Aza Pro. My UID: " + getOrCreateUID());
  window.open(`https://wa.me/${phone}?text=${message}`, "_blank");
};

/* --- UID --- */
function getOrCreateUID(){
  let uid = localStorage.getItem('userUID');
  if(!uid){ uid = 'UID-' + Math.random().toString(36).substring(2,11) + '-' + Date.now(); localStorage.setItem('userUID', uid); }
  return uid;
}
function copyUID(){ const uid = getOrCreateUID(); navigator.clipboard.writeText(uid).then(()=> { Swal.fire({icon:'success', title:'Copied UID', text: uid, timer:1600, showConfirmButton:false}); }); }

/* --- Bank card click --- */
document.querySelectorAll('.bank-card[data-page]').forEach(card=>{
  card.addEventListener('click', async e=>{
    const page = card.dataset.page;
    const check = checkStoredLicense();
    if(check.valid){
      window.location.href = page;
      return;
    }
    await showActivationPopup(page);
  });
});

/* --- checkStoredLicense --- */
function checkStoredLicense(){
  const token = localStorage.getItem('licenseToken');
  const start = localStorage.getItem('licenseStart');
  const plan = localStorage.getItem('licensePlan');
  if(!token || !start || !plan) return { valid:false };

  const startDate = new Date(parseInt(start,10));
  const now = new Date();

  const activationTime = new Date(startDate.getTime() + (5 * 60 * 1000));
  if(now < activationTime){
    return { valid:false, waiting:true, remaining: activationTime - now };
  }

  let days;
  if(plan === "week") days = 7;
  else if(plan === "month") days = 30;
  else if(plan === "unlimited") days = 365;
  else return { valid:false };

  const expiry = new Date(startDate.getTime() + days * 24 * 60 * 60 * 1000);
  if(now > expiry) return { valid:false, expired:true };

  return { valid:true };
}

/* --- Supabase validation --- */
async function validateTokenWithSupabase(token, uid, plan) {
  const { data, error } = await supabase
    .from('tokens')
    .select('*')
    .eq('token', token)
    .eq('plan', plan)
    .eq('valid', true)
    .maybeSingle();

  if (error) {
    console.error(error);
    return { valid: false };
  }

  if (!data) {
    return { valid: false };
  }

  if (data.used_by && data.used_by !== uid) {
    return { valid: false };
  }

  const activationStart = Date.now();
  await supabase
    .from('tokens')
    .update({ used_by: uid, activation_start: activationStart })
    .eq('token', token);

  return { valid: true, activationStart, plan: data.plan };
}

/* --- Activation popup --- */
async function showActivationPopup(redirectPage){
  const uid = getOrCreateUID();

  const { value: formData } = await Swal.fire({
    title: 'Enter License Token',
    html: `
      <input id="swToken" class="swal2-input" placeholder="Paste token here">
      <select id="swPlan" class="swal2-select" style="margin-top:10px;width:80%;">
        <option value="week">One Week</option>
        <option value="month">One Month</option>
        <option value="unlimited">Unlimited</option>
      </select>
      <div style="margin-top:10px"><b>Your UID:</b><br>${uid}</div>
    `,
    confirmButtonText: 'Activate',
    showCancelButton: true,
    preConfirm: () => {
      const token = document.getElementById('swToken').value && document.getElementById('swToken').value.trim();
      const plan = document.getElementById('swPlan').value;
      if(!token) { Swal.showValidationMessage('Please enter a token.'); return false; }
      return { token, plan };
    }
  });

  if(!formData) return;

  try {
    const result = await validateTokenWithSupabase(formData.token, uid, formData.plan);

    if (!result.valid) {
      Swal.fire('Invalid token','The token you entered is invalid. Please purchase a valid one.','error');
      return;
    }

    localStorage.setItem('licenseToken', formData.token);
    localStorage.setItem('licenseStart', String(result.activationStart));
    localStorage.setItem('licensePlan', result.plan);

    Swal.fire('Token accepted','Token saved. It will be active in 5 minutes.','success');
  } catch(err){
    console.error(err);
    Swal.fire('Error','Could not validate token. Please try again later.','error');
  }
}

/* --- Status button --- */
document.getElementById('statusBtn').onclick = function(){
  const check = checkStoredLicense();
  if(check.valid){
    Swal.fire('‚úÖ Active','Your token is valid and active.','success');
  } else if(check.waiting){
    const mins = Math.floor(check.remaining / 60000);
    const secs = Math.floor((check.remaining % 60000) / 1000);
    Swal.fire('‚è≥ Waiting','Token will activate in ' + mins + 'm ' + secs + 's.','info');
  } else {
    Swal.fire('‚ùå Inactive','No valid token found or token expired.','error');
  }
};

/* --- theme toggle --- */
const themeBtn = document.getElementById('themeToggle');
function setTheme(){ if(localStorage.getItem('theme')==='dark'){ document.body.classList.add('dark'); themeBtn.innerHTML='<i class="fa-solid fa-sun"></i>'; } else { document.body.classList.remove('dark'); themeBtn.innerHTML='<i class="fa-solid fa-moon"></i>'; } }
setTheme();
themeBtn.onclick = ()=>{ document.body.classList.toggle('dark'); localStorage.setItem('theme', document.body.classList.contains('dark')?'dark':'light'); setTheme(); };

getOrCreateUID();
</script>
</body>
</html>
