<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paste Aza Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --bg-light: #f5f5f5;
      --bg-dark: #121212;
      --text-light: #333;
      --text-dark: #fff;
      --card-light: #fff;
      --card-dark: #1e1e1e;
      --primary: #1a73e8;
    }
    body {margin:0;font-family:Arial, sans-serif;background:var(--bg-light);color:var(--text-light);transition:0.3s;}
    body.dark {background:var(--bg-dark);color:var(--text-dark);}
    .container{padding:20px;}
    h2{text-align:center;margin-bottom:20px;color:var(--primary);}
    .banks{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;}
    .bank-card{background:var(--card-light);padding:25px 15px;text-align:center;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);cursor:pointer;transition:0.2s;}
    body.dark .bank-card{background:var(--card-dark);box-shadow:0 4px 6px rgba(255,255,255,0.05);}
    .bank-card:hover{transform:translateY(-4px);}
    .bank-card i{font-size:28px;color:var(--primary);margin-bottom:8px;}
    .bank-card h3{margin:0;font-size:15px;}
    .actions{text-align:center;margin-top:30px;}
    .actions button,.actions a{margin:10px;padding:10px 15px;border:none;border-radius:8px;cursor:pointer;font-size:14px;background:var(--primary);color:#fff;text-decoration:none;display:inline-block;}
    .header-row{display:flex;align-items:center;justify-content:space-between;background:var(--primary);color:#fff;padding:15px;font-size:20px;font-weight:bold;}
    .header-row img{height:24px;cursor:pointer;}
    .header-row .title{flex:1;text-align:center;}
    .header-row .right-controls{display:flex;gap:8px;align-items:center;}
    .small-btn{background:transparent;border:none;color:#fff;padding:8px;border-radius:20px;cursor:pointer;font-size:16px;}

    /* Lottie container for Windows block */
    #lottieBlock {
      position:fixed;
      top:0;left:0;
      width:100%;height:100%;
      background:#000;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:9999;
      color:#fff;
      font-size:22px;
      font-weight:bold;
    }
    #lottie {
      width:250px;height:250px;
      margin-bottom:20px;
    }
  </style>
</head>
<body>

  <!-- Block overlay (hidden until Windows detected) -->
  <div id="lottieBlock" style="display:none;">
    <div id="lottie"></div>
    <div>419 Cheating</div>
  </div>

  <div class="header-row">
    <img src="images/back.png" alt="back" id="backArrow">
    <div class="title">Paste Aza Pro</div>
    <div class="right-controls">
      <button id="statusBtn" class="small-btn" title="View Status"><i class="fa-solid fa-id-badge"></i></button>
      <button class="small-btn" id="themeToggle" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </div>
  </div>

  <div class="container">
    <h2>Choose a Bank to Generate Receipt</h2>
    <div class="banks">
      <div class="bank-card" data-page="palmpayform.html" onclick="onBankClick(event)">
        <i class="fa-solid fa-building-columns"></i>
        <h3>PalmPay</h3>
      </div>
      <div class="bank-card" data-page="opayform.html" onclick="onBankClick(event)">
        <i class="fa-solid fa-building-columns"></i>
        <h3>Opay</h3>
      </div>
      <div class="bank-card" data-page="receiptform.html" onclick="onBankClick(event)">
        <i class="fa-solid fa-building-columns"></i>
        <h3>Kuda</h3>
      </div>
    </div>

    <div class="actions">
      <button onclick="copyUID()">üìã Copy UID</button>
      <a href="developer.html">üí¨ Contact Developer</a>
      <a href="status.html" style="background:green;">üîç View Status</a>
    </div>
  </div>

<script>
  // Block inspect tools and right-click
  document.onkeydown = function(e){
    if(e.keyCode==123 || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase())) || (e.ctrlKey && e.key.toUpperCase()=='U')) {
      return false;
    }
  };
  document.addEventListener('contextmenu', e => e.preventDefault());

  // Detect platform
  function detectPlatform() {
    const ua = navigator.userAgent.toLowerCase();
    if (/android/i.test(ua)) return "android";
    if (/iphone|ipad|ipod/i.test(ua)) return "ios";
    if (/win/i.test(ua)) return "windows";
    return "other";
  }

  function blockWindows() {
    document.getElementById("lottieBlock").style.display = "flex";
    lottie.loadAnimation({
      container: document.getElementById("lottie"),
      renderer: "svg",
      loop: true,
      autoplay: true,
      path: "https://assets1.lottiefiles.com/packages/lf20_j1adxtyb.json"
    });
    document.body.style.overflow="hidden";
  }

  const platform = detectPlatform();
  if (platform==="windows" || platform==="other") {
    blockWindows();
  }

  // --- UID ---
  function getOrCreateUID() {
    let uid = localStorage.getItem('userUID');
    if (!uid) {
      uid = 'UID-' + Math.random().toString(36).substring(2,11) + '-' + Date.now();
      localStorage.setItem('userUID', uid);
    }
    return uid;
  }

  function copyUID() {
    const uid = getOrCreateUID();
    navigator.clipboard.writeText(uid).then(() => {
      Swal.fire({icon:'success', title:'Copied UID', text: uid, timer:1600, showConfirmButton:false});
    });
  }

  // --- Token Validation ---
  function validateTokenFormat(token, uid) {
    if (!token.startsWith('A' + uid)) return {ok:false};

    const rest = token.slice(('A' + uid).length);
    const cycles = {
      7: {W:"KPACTW", M:"KPACTM", U:"KPACTU"},
      8: {W:"BKPACTW", M:"CKPACTM", U:"DKPACTU"},
      9: {W:"EKPACTW", M:"FKPACTM", U:"GKPACTU"},
      10:{W:"HKPACTW", M:"IKPACTM", U:"JKPACTU"},
      5: {W:"LKPACTW", M:"MKPACTM", U:"NKPACTU"},
      6: {W:"OKPACTW", M:"PKPACTM", U:"QKPACTU"},
    };

    const match = rest.match(/^(\d+)([A-Z]+)$/);
    if (!match) return {ok:false};
    const digits = match[1];
    const suffix = match[2];
    const len = digits.length;

    const cycle = cycles[len];
    if (!cycle) return {ok:false};

    let plan=null, days=0;
    if (digits.split('').every(d=>d===digits[0])) {
      if (suffix===cycle.W){plan='week';days=7;}
      if (suffix===cycle.M){plan='month';days=30;}
      if (suffix===cycle.U){plan='unlimited';days=Infinity;}
    }
    if (!plan) return {ok:false};

    return {ok:true, plan, days};
  }

  function checkStoredLicense() {
    const token = localStorage.getItem('licenseToken');
    const uid = getOrCreateUID();
    if (!token) return {valid:false};
    const parsed = validateTokenFormat(token, uid);
    if (!parsed.ok) return {valid:false};
    if (parsed.plan==='unlimited') return {valid:true, plan:'unlimited', expiry:'Never'};

    const startIso = localStorage.getItem('licenseStart');
    if (!startIso) return {valid:false};
    const startDate = new Date(startIso);
    const expiry = new Date(startDate);
    expiry.setDate(expiry.getDate()+parsed.days);
    return {valid:new Date()<=expiry, plan:parsed.plan, expiry:expiry.toISOString()};
  }

  function showActivationPopup(page){
    const uid = getOrCreateUID();
    Swal.fire({
      title:'Enter License Token',
      html:'<input id="swToken" class="swal2-input" placeholder="Paste token here">'+
           '<div style="margin-top:10px"><b>Your UID:</b><br>'+uid+'</div>',
      confirmButtonText:'Activate',
      showCancelButton:true,
      preConfirm:()=>document.getElementById('swToken').value
    }).then(res=>{
      if(res.isConfirmed){
        const token = res.value.trim();
        const fmt = validateTokenFormat(token, uid);
        if(!fmt.ok){ Swal.fire('Invalid','Wrong or expired token','error'); return; }
        localStorage.setItem('licenseToken', token);
        localStorage.setItem('licenseStart', new Date().toISOString());
        Swal.fire('Activated','Redirecting...','success').then(()=>window.location.href=page);
      }
    });
  }

  // --- Bank Button Click ---
  function onBankClick(e){
    const page = e.currentTarget.dataset.page;
    const check = checkStoredLicense();
    if (check.valid) { window.location.href = page; return; }
    showActivationPopup(page);
  }

  // --- Theme toggle ---
  const themeBtn=document.getElementById('themeToggle');
  function setTheme(){ 
    if(localStorage.getItem('theme')==='dark'){
      document.body.classList.add('dark');
      themeBtn.innerHTML='<i class="fa-solid fa-sun"></i>';
    }else{
      document.body.classList.remove('dark');
      themeBtn.innerHTML='<i class="fa-solid fa-moon"></i>';
    }
  }
  setTheme();
  themeBtn.onclick=()=>{document.body.classList.toggle('dark');localStorage.setItem('theme',document.body.classList.contains('dark')?'dark':'light');setTheme();};

  document.getElementById('statusBtn').onclick=()=>location.href='status.html';
  document.getElementById('backArrow').onclick=()=>location.href='index.html';

  getOrCreateUID();
</script>
</body>
</html>
